/*!
 * Postcode.eu international address autocompletion
 *
 * https://developer.postcode.eu/documentation/international/javascript
 *
 * Copyright Postcode.nl
 * Released under the Apple MIT License (AML)
 * https://www.tldrlegal.com/license/apple-mit-license-aml
 *
 * @author Postcode.nl
 * @version 1.4.0
 */
!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],t):(e.PostcodeNl=e.PostcodeNl||{},e.PostcodeNl.AutocompleteAddress=t())}("undefined"!=typeof self?self:this,(function(){"use strict";const e=window.document,t=new WeakMap,n="autocomplete-",s="Address",o=Object.create(null,{context:{value:"nld",writable:!0},autocompleteUrl:{writable:!0},addressDetailsUrl:{writable:!0},tags:{value:{"unvalidated-housenumber":"(unknown house number)","unvalidated-housenumber-addition":"(unknown house number addition)"},writable:!0},cssPrefix:{value:"postcodenl-autocomplete-",writable:!0},minLength:{value:1,writable:!0},delay:{value:300,writable:!0},appendTo:{value:e.body,writable:!0},autoFocus:{value:!0,writable:!0},autoSelectSingleAddress:{value:!0,writable:!0},autoResize:{value:!0,writable:!0},getResponseMessage:{value:function(e){let t;return t=e>1?e+" address suggestions available. ":"One address suggestion available. ",t+="Use up and down arrow keys to navigate.",t},writable:!0},language:{writable:!0}}),i=function(s){const o=this,i=e.createElement("ul"),l=e.createElement("div"),r={menuOpen:s.cssPrefix+"menu-open",itemFocus:s.cssPrefix+"item-focus"},a=function(e,s,o){const l=i.children.length;if(0===l)return;u(),o=o||!1;let a,d=e;if((s=s||!1)&&(null===b?d=e>0?e-1:l+e:(a=c(b),d=a+e)),d%=l,d=d>=0?d:l+d,s&&null!==b&&(e>0&&d<a||e<0&&d>a))return b=null,f.value=h,void(t.get(f).context=v);b=i.children[d],b.classList.add(r.itemFocus),i.scrollTop>b.offsetTop?i.scrollTop=b.offsetTop:b.offsetHeight+b.offsetTop>i.clientHeight&&(i.scrollTop=b.offsetHeight+b.offsetTop-i.clientHeight);const p=t.get(b);o&&!0===f.dispatchEvent(new CustomEvent(n+"focus",{detail:p,cancelable:!0,bubbles:!0}))&&(f.value=p.value,t.get(f).context=p.context,w=d)},c=function(e){return Array.prototype.indexOf.call(i.children,e)},u=function(){null!==b&&b.classList.remove(r.itemFocus)},d=function(e){g&&e.target!==f&&!l.contains(e.target)&&o.close()},p=function(){g&&o.close()};let f,h,v,g=!1,m=!1,b=null,w=null;Object.defineProperties(this,{isOpen:{get:function(){return g}},isMousedown:{get:function(){return m}},hasFocus:{get:function(){return null!==b}},wrapper:{get:function(){return l}},ul:{get:function(){return i}},suppress:{value:!1,writable:!0}}),l.classList.add(s.cssPrefix+"menu"),i.classList.add(s.cssPrefix+"menu-items"),l.appendChild(i),i.addEventListener("mousemove",(function(e){if(e.target===b||e.target===i)return;u();let t=e.target;for(;t.parentElement!==i;)t=t.parentElement;b=t,b.classList.add(r.itemFocus)})),i.addEventListener("mouseout",(function(){o.blur(),null!==w&&a(w)})),l.addEventListener("mousedown",(function(){m=!0})),l.addEventListener("click",(function(e){e.preventDefault(),null!==b&&o.select(),window.setTimeout((function(){m=!1}))})),HTMLElement.prototype.isPrototypeOf(s.appendTo)?s.appendTo.appendChild(l):(e.querySelector(s.appendTo)||e.body).appendChild(l),this.setItems=function(e,n){i.innerHTML="",i.scrollTop=0;for(let s,o,l=0;o=e[l++];)s=n(i,o),t.set(s,o);b=null,w=null},this.open=function(e){f=e,h=f.value,v=t.get(f).context,s.autoFocus&&null===w&&(w=0),null!==w&&a(w),g||this.suppress||(!function(e){const t=e.getBoundingClientRect();l.style.top=t.bottom+(window.scrollY||window.pageYOffset)+"px",l.style.left=t.left+(window.scrollX||window.pageXOffset)+"px",s.autoResize&&(l.style.width=t.width+"px")}(f),l.classList.add(r.menuOpen),i.scrollTop=0,g=!0,f.dispatchEvent(new CustomEvent(n+"open",{bubbles:!0})))},this.close=function(e){g&&(e&&(f.value=h,t.get(f).context=v,w=null),o.blur(),l.classList.remove(r.menuOpen),g=!1,f.dispatchEvent(new CustomEvent(n+"close",{bubbles:!0})))},this.focusPrevious=a.bind(this,-1,!0),this.focusNext=a.bind(this,1,!0),this.blur=function(){u(),b=null},this.select=function(e){const s=t.get(b),o=c(b);!0===f.dispatchEvent(new CustomEvent(n+"select",{detail:s,cancelable:!0,bubbles:!0}))&&(f.value=s.value,w=o),(void 0===e||e)&&f.focus()},this.clear=function(){u(),b=null,w=null,i.innerHTML=""},this.destroy=function(){return null!==l.parentNode&&(l.parentNode.removeChild(l),e.removeEventListener("click",d),window.removeEventListener("resize",p),!0)},e.addEventListener("click",d),window.addEventListener("resize",p)},l=function(){const e=new Uint8Array(32),t=[],n="0123456789abcdef";(window.crypto||window.msCrypto).getRandomValues(e);for(let s=0,o=16;s<32;s++)t.push(n[e[s]%o]);return t.join("")},r=function(e){return Object.prototype.toString.call(e).slice(8,-1)};if("function"!=typeof window.CustomEvent){const t=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:null};var s=e.createEvent("CustomEvent");return s.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),s};window.CustomEvent=t}0===window.DOMTokenList.prototype.toggle.length&&(window.DOMTokenList.prototype.toggle=function(e){return arguments.length>1?(this[arguments[1]?"add":"remove"](e),!!arguments[1]):(this[this.contains(e)?"remove":"add"](e),this.contains(e))});const a=function(a,c){let u;if("String"===r(a))d=a,u=e.querySelectorAll(d);else if(HTMLElement.prototype.isPrototypeOf(a))u=[a];else{if(!NodeList.prototype.isPrototypeOf(a))throw new TypeError("Element(s) or selector has invalid type. Use HTMLElement, NodeList or valid CSS selector string.");u=a}var d;if(0===u.length)return;(c=function(e,t){for(let n in t)e[n]=t[n];return e}(Object.create(o),c)).context=c.context.toLowerCase(),Object.defineProperty(this,"options",{get:function(){return c}});let p=null,f=null,h=null,v=null,g=null,m=[];const b=this,w=new i(c),E=c.cssPrefix+"address-input-blank",x=l(),L=e.createElement("div"),y="aria-live-region";L.id=function(t){let n=2,s=t;for(;null!==e.getElementById(s);)s=t+"-"+n,n++;return s}(y),L.setAttribute("aria-role","status"),L.setAttribute("aria-live","assertive"),L.classList.add(c.cssPrefix+y),e.body.appendChild(L),window.addEventListener("beforeunload",(function(){window.clearTimeout(p)})),Object.defineProperty(this,"elements",{get:function(){return{menu:w.wrapper,menuItems:w.ul,liveRegion:L}}}),this.announce=function(e){L.innerHTML="<div>"+e+"</div>"},this.xhrGet=function(e,s){null!==v&&v.readyState<4&&v.abort(),v=new XMLHttpRequest,v.addEventListener("load",(function(){200===this.status&&s.call(this,JSON.parse(v.response))}));let o=x;if(null!==g){const e=g,s=function(t){200!==this.status&&e.dispatchEvent(new CustomEvent(n+"error",{detail:{event:t,request:this},bubbles:!0}))};o=t.get(e).sessionId,v.addEventListener("error",s),v.addEventListener("load",s),e.classList.add(c.cssPrefix+"loading"),v.addEventListener("loadend",(function(){e.classList.remove(c.cssPrefix+"loading")}))}return v.open("GET",e),v.setRequestHeader("X-Autocomplete-Session",o),v.send(),v},this.getSuggestions=function(e,t,n){let s=this.options.autocompleteUrl+"/"+encodeURIComponent(e)+"/"+encodeURIComponent(t);return void 0!==c.language&&(s+="/"+c.language),this.xhrGet(s,n)},this.getDetails=function(e){let t=null,n=arguments[1];const s=[e];return 3===arguments.length&&(t=arguments[1],n=arguments[2],s.push(t)),this.xhrGet(this.options.addressDetailsUrl+"/"+s.join("/"),n)},this.renderItem=function(t,n){const o=e.createElement("li"),i=e.createElement("span");if(o.classList.add(this.options.cssPrefix+"item"),i.classList.add(this.options.cssPrefix+"item-label"),i.innerHTML=this.highlight(n.label,n.highlights),o.appendChild(i),n.precision!==s&&o.classList.add(this.options.cssPrefix+"item-more"),n.description){const t=e.createElement("span");t.textContent=n.description,t.classList.add(this.options.cssPrefix+"item-description"),o.appendChild(t)}if(n.tags)for(let t,s=0;t=n.tags[s++];){const n=e.createElement("em");n.textContent=this.options.tags[t],n.classList.add(this.options.cssPrefix+"item-tag"),o.appendChild(n)}return t.appendChild(o),o},this.highlight=function(e,t){if(0===t.length)return e;let n,s=0,o=0,i=0,l=[];for(;n=t[s++];)l.push(e.slice(i,n[0])),o=n[0],i=n[1],l.push("<mark>"+e.slice(o,i)+"</mark>");return l.push(e.slice(i)),l.join("")},this.setCountry=function(e){c.context=e.toLowerCase();for(let e,n=0;e=u[n++];)t.get(e).context=c.context},this.setLanguage=function(e){c.language=e},this.search=function(e){let n;if(n="Object"===r(arguments[1])?arguments[1]:{term:arguments[1],context:arguments[2]},void 0!==n.term&&(e.value=n.term),void 0!==n.context){const s=t.get(e);s.context=n.context,t.set(e,s)}const s=w.suppress;w.suppress=!(void 0===n.showMenu||n.showMenu),g=e,e.classList.toggle(E,""===e.value),P(e),w.suppress=s},this.reset=function(){f=null,h=null,m=[],w.clear();for(let e,n=0;e=u[n++];){const n=t.get(e);n.context=c.context,n.match={},e.value="",e.classList.add(E)}},this.destroy=function(){if(w.destroy()){e.body.removeChild(L);for(let e,o=0;e=u[o++];){const o=t.get(e);for(var n in o.eventHandlers)e.removeEventListener(n,o.eventHandlers[n]);for(var s in o.initialAttributeValues){const t=o.initialAttributeValues[s];null===t?e.removeAttribute(s):e.setAttribute(s,t)}t.delete(e),e.classList.remove(c.cssPrefix+"address-input",c.cssPrefix+"loading",E)}}},Array.prototype.forEach.call(u,(function(e){const o=Object.create(null);let i=!1;t.set(e,{match:{},context:c.context,eventHandlers:o,initialAttributeValues:{spellcheck:e.hasAttribute("spellcheck")?e.getAttribute("spellcheck"):null,autocomplete:e.hasAttribute("autocomplete")?e.getAttribute("autocomplete"):null,"aria-controls":e.hasAttribute("aria-controls")?e.getAttribute("aria-controls"):null},sessionId:l()}),!1===e.hasAttribute("autocomplete")&&(e.autocomplete="off"),e.spellcheck=!1,e.setAttribute("aria-controls",L.id),e.classList.add(c.cssPrefix+"address-input"),e.classList.toggle(E,""===e.value),e.addEventListener("keydown",o.keydown=function(t){switch(i=!0,t.key){case"ArrowUp":case"Up":w.isOpen?w.focusPrevious(!0):P(e),t.preventDefault();break;case"ArrowDown":case"Down":w.isOpen?w.focusNext(!0):P(e),t.preventDefault();break;case"Escape":case"Esc":w.close(!0);break;case"Tab":w.hasFocus&&(w.select(),t.preventDefault());break;case"Enter":w.hasFocus?(w.select(),t.preventDefault()):w.close();break;default:T(e)}}),e.addEventListener("input",o.input=function(){e.classList.remove(E),w.blur(),m=[],i?i=!1:T(e)}),e.addEventListener("focus",o.focus=function(){if(w.isMousedown)return;w.open(e);const n=t.get(e);void 0!==n.match.precision&&n.match.precision===s||P(e)}),e.addEventListener("click",o.click=w.open.bind(w,e)),e.addEventListener(n+"select",o[n+"select"]=function(n){const o=t.get(e);o.match=n.detail,n.detail.precision===s?w.close():(w.open(e),o.context=n.detail.context,window.setTimeout(P,0,e))}),e.addEventListener("blur",o.blur=function(){w.isMousedown||(window.clearTimeout(p),C(),w.close(),e.classList.toggle(E,""===e.value))}),e.dispatchEvent(new CustomEvent(n+"create",{detail:b,bubbles:!0}))}));const C=function(){c.autoFocus&&c.autoSelectSingleAddress&&w.hasFocus&&1===m.length&&m[0].precision===s&&w.select(!1)},T=function(e){window.clearTimeout(p);let t=10;e.value.length>3&&(t=c.delay),p=window.setTimeout(P,t,e)},P=function(e){w.open(e);const s=t.get(e);if(g=e,e.value===f&&s.context===h)return;const o=s.context===h&&null!==f&&(0===e.value.indexOf(f)||0===f.indexOf(e.value));if(f=e.value,h=s.context,s.match={},e.value.length<c.minLength)return s.context=c.context,void w.clear();if(!1===e.dispatchEvent(new CustomEvent(n+"search",{cancelable:!0,bubbles:!0})))return;const i=w.suppress;b.getSuggestions.call(b,s.context,e.value,(function(t){if("String"===r(t.newContext)&&(s.context=t.newContext),!0===e.dispatchEvent(new CustomEvent(n+"response",{detail:t,cancelable:!0,bubbles:!0}))){if(m=t.matches||[],o&&0===m.length)return;w.setItems(m,b.renderItem.bind(b)),b.announce(c.getResponseMessage(m.length,c.language)),!1===i&&w.open(e)}}))}};return Object.defineProperty(a,"defaults",{get:function(){return o}}),Object.defineProperty(a,"version",{value:"1.4.0"}),a}));